# Trickster
![img](163)

### Web page
![img](164)

### Solution

Xem source page: 

![img](165)

=> Chưa tìm được thông tin hữu ích.

Có vẻ thử thách này liên quan đến lỗ hổng trong upload files. Thử dùng **dirsearch** duyêt qua web, tìm nơi lưu trữ file được upload: 

![img](166)

Thử truy cập file **/robots.txt**:

![img](167)

=> Tìm được 2 path **/instructions.txt** và **/uploads**. Thử truy cập **/instructions.txt**:

![img](168)

=> Có thể thấy server chỉ chấp nhận upload file **.png**. Ý tưởng để khai thác lỗ hổng upload files là tạo 1 payload và chuyển định dạng extension của file payload này thành định dạng mà server yêu cầu, ở đây là **.png**. 

Tạo 1 payload **shell.php** có nội dung: 

    <?php
    echo system (“whoami”);
    ?>

Để có thể chỉnh extension **.php** thành **.png**, sử dụng **hexeditor**. Dùng lệnh **hexeditor shell.php** để chỉnh sửa magic number của file **.php** thành magic number của file **.png** (**magic number** là một chuỗi byte đặc biệt ở đầu file, giúp xác định loại file thực sự): 

![img](169)

Mở Burp Suite, Intercept quá trình upload file **shell.php**, lúc này đã được đổi tên thành **shell.png**:

![img](170)

=> Upload thành công.

Tiếp theo để thực thi file **shell.php** thêm **.php** vào cuối tên file, trở thành **shell.png.php** và sửa đổi content-type header từ **Content-Type: image/png** thành **Content-Type: application/php**. Sau đó send request: 

![img](171)

=> Vẫn upload thành công là do server chỉ kiểm tra magic number của file để xác định file type thực sự. Vì đã thay đổi magic number của file **.php** thành magic number của file **.png** nên server vẫn xác thực upload file hợp lệ.

Như đã tìm thấy ở trên, có vẻ **/uploads** sẽ là nơi lưu trữ file được upload lên nhưng truy nhập **/uploads** sẽ bị forbidden, cần truy cập thẳng vào file như sau **/uploads/shell.png.php**:

![img](172)


=> **shell.png.php** đã được thực thi thành công, in ra response cho câu lệnh **whoami**. Lúc này chỉ cần sửa câu lệnh **whoami** thành **find / -name .txt** để tìm tất cả các file có extension là **.txt**:

![img](173)

Send request này trong Burp Suite và Refresh lại web page:

![img](174)

=> Tìm ra file **/var/www/html/MFRDAZLDMUYDG.txt** có vẻ khả nghi. Sửa payload thành lệnh **cat** để đọc file này:

![img](175)

Send request và refresh lại page:

![img](176)

**Flag: picoCTF{c3rt!fi3d_Xp3rt_tr1ckst3r_ab0ece03}**


