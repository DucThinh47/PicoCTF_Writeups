# More Cookies
![img](81)

### Web page
![img](82)

### Solution

Xem source page:

![img](83)

Không tìm được thông tin gì hữu ích.

Dựa vào tên thử thách, thử mở Inspector và kiểm tra cookies: 

![img](84)

=> Tìm được cookie có name là **auth_name** và value là ***czJja21RZnppTkVaOUp2N0E0eEZDRmtVNGg1QjcrSVg0TTJONDQrdnRrN3FwWExhRUd6WFhMSVFhZVJ0R3R5dVRIUDBxQVoxR0VGQUpTM0RNbWNQTDNldFR2dTExaEdhSHF1NUw2NVZVV0d0cm9lT0l4d1dzR3hBM1BxVnJvYU0=***

Giá trị này trông như một chuỗi base64 nhưng khi decode chuỗi base64 này sẽ ra một chuỗi vô nghĩa. 

Theo như mô tả của đề, **Cookies can Be modified Client-side**, 3 chữ C,B,C được viết hoa như để gợi ý rằng challenge có liên quan đến **CBC** (Cipher Block Chaining). Về cơ bản, có **1 bit** trong chuỗi xác định xem user có phải admin không, nếu thay đổi đúng bit này thì có thể set admin=1. Như vậy ý tưởng sẽ là thay đổi mọi vị trí trong giá trị cookie **auth_name** cho đến khi tìm được flag.

Viết 1 đoạn mã python thực hiện công việc này:

    import base64 
    from tqdm import tqdm

    ADDRESS = "http://mercury.picoctf.net:15614/"

    s = requests.Session() 
    s.get(ADDRESS) 
    cookie = s.cookies["auth_name"]  
    decoded_cookie = base64.b64decode(cookie) 
    raw_cookie = base64.b64decode(decoded_cookie)

    def exploit():  
        for position_idx in tqdm(range(0, len(raw_cookie))):  
            for bit_idx in range(0, 8):    
                bitflip_guess = ( raw_cookie[0:position_idx] + ((raw_cookie[position_idx] ^ (1 << bit_idx)).to_bytes(1, "big")) + raw_cookie[position_idx + 1 :] )

            # Double base64 encode the bit-blipped cookie following the encoding scheme.
            guess = base64.b64encode(base64.b64encode(bitflip_guess)).decode()

            # Send a request with the cookie to the application and scan for the
            # beginning of the flag.
            r = requests.get(ADDRESS, cookies={"auth_name": guess})
            if "picoCTF{" in r.text:
                print(f"Admin bit found in byte {position_idx} bit {bit_idx}.")
                # The flag is between `<code>` and `</code>`.
                print("Flag: " + r.text.split("<code>")[1].split("</code>")[0])
                return
    exploit()

Đoạn code này thực hiện một cuộc tấn công **bit-flipping** vào một cookie được mã hóa bằng Base64.

**Bit-flipping**: Kỹ thuật này thay đổi một bit trong dữ liệu (ở đây là cookie) để thử nghiệm xem liệu việc thay đổi đó có dẫn đến một trạng thái hợp lệ hay không (ví dụ: trở thành admin hoặc lấy được flag).

**Base64 encoding**: Cookie được mã hóa hai lần bằng Base64, vì vậy cần giải mã hai lần để lấy dữ liệu gốc và mã hóa lại sau khi bit-flip.

Mỗi lần lật bit, cookie được gửi trả lại đến server để kiểm tra. Nếu server trả về flag, tấn công thành công.

Thực thi script này: 

![img](85)

**Flag: picoCTF{cO0ki3s_yum_82f39377}**
