# SOAP
![img](123)

# Web page
![img](124)

# Solution

Mở Burp Suite, click xem Detail một sản phẩm và Intercept request này: 

![img](125)

=> Có đoạn mã XML xuất hiện trong Request. Thử Send Request này tới Repeater:

![img](126)

Thử thay phần tử ID thành 0 và send Request:

![img](127)

=> Server phản hồi **"Invalid ID: 0"**.

Thử cách khác, về XML, có lỗ hổng liên quan là **XXE** - *XML external entity Injection*. Thử search xxe payload, truy cập https://portswigger.net/web-security/xxe:

![img](128)

Thử chèn payload này vào request và send request:

![img](129)

=> Phân tích 2 đoạn mã XML: 

Mã XML ban đầu:

    <?xml version="1.0" encoding="UTF-8"?>
    <data>
        <ID>
            1
        </ID>
    </data>

- Đây là một đoạn mã XML đơn giản, không có gì đặc biệt.

- Nó khai báo phiên bản XML **(1.0)** và encoding **(UTF-8)**.

- Phần tử **ID** chứa giá trị 1.

- Đoạn mã này hoàn toàn an toàn và không có bất kỳ lỗ hổng nào.

XML Payload: 

    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd">]>
    <data>
        <ID>
            &xxe;
        </ID>
    </data>

- Đoạn mã này cũng khai báo phiên bản XML và encoding giống như đoạn mã thứ nhất.

- Tuy nhiên, nó có thêm một phần **<!DOCTYPE>**, trong đó định nghĩa một **entity ngoại** (external entity) có tên là **xxe**.

- Entity **xxe** được khai báo với từ khóa **SYSTEM**, và nó trỏ đến một tệp tin cục bộ trên hệ thống: **file:///etc/passwd**.

- Trong phần tử **ID**, giá trị **&xxe**; được sử dụng để tham chiếu đến entity **xxe**.

=> Tại sao mã XML lại gây ra lỗ hổng XXE: 

1. Khai thác **External Entity**:

- Trong XML, **entity** là một cách để định nghĩa các giá trị có thể được tái sử dụng trong tài liệu.

- Khi **entity** được định nghĩa với từ khóa **SYSTEM**, nó có thể tham chiếu đến một tài nguyên bên ngoài, chẳng hạn như một tệp tin trên hệ thống hoặc một URL từ xa.

- Trong đoạn mã, entity **xxe** được định nghĩa để tham chiếu đến tệp tin **/etc/passwd** trên hệ thống.

2. Cơ chế tấn công **XXE**:

- Khi server nhận được đoạn mã, nó sẽ phân tích (parse) XML và thực hiện tham chiếu đến entity **xxe**.

- Do entity **xxe** được định nghĩa để tham chiếu đến tệp tin **/etc/passwd**, server sẽ đọc nội dung của tệp tin này và chèn nó vào vị trí của **&xxe**;.

- Kết quả là nội dung của tệp tin **/etc/passwd** (chứa thông tin người dùng trên hệ thống) sẽ được trả về trong response của server.


**Flag: picoCTF{XML_3xtern@l_3nt1t1ty_4dbeb2ed}**





