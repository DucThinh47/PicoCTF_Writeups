# No Sql Injection
![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image95.png?raw=true)

### Web page
![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image96.png?raw=true)

### Solution

Download source code thử thách cung cấp: 

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image97.png?raw=true)

=> Giải nén file **app.tar.gz**:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image98.png?raw=true)

Thử dùng **dirsearch** duyệt qua web: 

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image99.png?raw=true)

=> Tìm được path **/admin**, truy cập thử trên web page: 

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image100.png?raw=true)

=> Chưa tìm được gì.

Tiếp tục giải nén file **app.tar**: 

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image101.png?raw=true)

Xem nội dung file **server.js**:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image102.png?raw=true)

=> Script cho thấy server có vẻ như đang cố gắng xử lý input có format giống JSON trong field email và password, điều này có thể gây ra No SQL Injection vulnerabilites.

Điều kiện **email.startsWith(“{”) && email.endsWith(“}”)** sẽ kiểm tra xem chuỗi email có bắt đầu bằng dấu ngoặc nhọn "{" và kết thúc bằng dấu ngoặc nhọn "}" hay không. 

Điều kiện này thường được sử dụng để xác định xem giá trị email có phải là chuỗi được mã hóa JSON hay không. Ví dụ: nếu email là **{"$ne":null}** thì điều này sẽ đáp ứng điều kiện vì đó là một chuỗi giống JSON.

Đồng thời nhận thấy web server đang được sử dụng là **Mongo server**. Thử search payload dành cho Mongo server:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image103.png?raw=true)

Truy cập https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/NoSQL%20Injection/README.md tìm được 1 payload:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image104.png?raw=true)

Đồng thời trong file **server.js** tìm được 1 email nhưng password đã được mã hóa:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image105.png?raw=true)

Lợi dụng lỗ hổng, thử điền password là **{“$ne”:null}**. Intercept login request này trong Burp Suite: 

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image106.png?raw=true)

--> Login thành công. Thu được token từ server response **cGljb0NURntqQmhEMnk3WG9OelB2XzFZeFM5RXc1cUwwdUk2cGFzcWxfaW5qZWN0aW9uXzY3YjFhM2M4fQ==**.

Thử giải mã token này dưới dạng Base64:

![img](https://github.com/DucThinh47/PicoCTF_Writeups/blob/main/Web_Exploitation/images/image107.png?raw=true)

**Flag: picoCTF{jBhD2y7XoNzPv_1YxS9Ew5qL0uI6pasql_injection_67b1a3c8}**
