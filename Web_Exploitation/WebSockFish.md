# WebSockFish

![img](305)

Truy cập website:

![img](306)

Là một website giả lập cờ vua, tôi đã thử chơi một lúc và không phát hiện ra được gì đặc biệt. 

Dựa vào tên thử thách, tôi nghĩ rằng có liên quan đến `WebSocket` -  giao thức hỗ trợ giao tiếp hai chiều giữa client và server để tạo một kết nối trao đổi dữ liệu. Giao thức này không sử dụng `HTTP` mà thực hiện nó qua `TCP`. 

Xem qua source code, tôi tìm được đoạn code xử lý response từ engine Stockfish: 

    if (event.data.startsWith("bestmove")) {
          var bestMove = event.data.split(" ")[1];
          var srcSq = bestMove.slice(0, 2);
          var dstSq = bestMove.slice(2, 4);
          var promotion = bestMove.slice(4);

          game.move({ from: srcSq, to: dstSq, promotion: promotion });
          board.position(game.fen());
    } else if (event.data.startsWith(`info depth ${DEPTH}`)) {
          var splitString = event.data.split(" ");
          if (event.data.includes("mate")) {
            message = "mate " + parseInt(splitString[9]);
          } else {
            message = "eval " + parseInt(splitString[9]);
          }
          sendMessage(message);
    }

Dựa vào đoạn code này, tôi suy ra được đây là cách đánh giá kết quả từ engine `Stockfish` khi phân tích thế cờ hiện tại. Như vậy, nếu tôi có thể điều khiển cách mà `Stockfish` trả về, nghĩa là điều khiển message gửi qua `WebSocket`. 

Đồng thời tôi tìm được `sendMessage()` function:

    function sendMessage(message) {
        ws.send(message);
    }

Tiếp theo, tôi thử gửi `ws.send("bestmove")` xem có phản hồi gì khác từ con cá không:

![img](307)

Không có gì thay đổi. Tiếp theo tôi sẽ thử gửi `mate 0`:

![img](308)

=> Phản hồi từ con cá đã khác đi. Tiếp theo tôi thử gửi `mate 9999`: 

![img](309)

Vẫn không có tiết lộ gì mới. Tiếp theo tôi sẽ thử gửi `eval 0`:

![img](310)

=> Con cá phản hồi `I think this position is pretty equal`. Có thể đã gần đúng, tôi thử gửi `eval 9999`:

![img](311)

=> `You're in deep water now!` - có thể là một gợi ý, 9999 quá lớn, nên tôi đã thử gửi `eval -9999`:

![img](312)

=> `Wow you're quite the chess shark!` - tôi thử gửi 1 số âm bé hơn nữa là `eval -99999`: 

![img](313)

Như vậy đã tìm được flag. 


